<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ë§¤ë¬¼ ì •ë³´ - íœ™</title>

    <!-- ê¸°ë³¸ OG (ì¹´ì¹´ì˜¤ í¬ë¡¤ëŸ¬ìš© - JS ë¯¸ì‹¤í–‰ í™˜ê²½) -->
    <meta property="og:type" content="website">
    <meta property="og:site_name" content="íœ™ - ë§¤ë¬¼ì¹´ë“œ">
    <meta property="og:title" content="ë§¤ë¬¼ ì •ë³´ - íœ™">
    <meta property="og:description" content="ì¤‘ê°œì‚¬ê°€ ì§ì ‘ ë³´ë‚´ëŠ” ë§¤ë¬¼ ì¹´ë“œì˜ˆìš”. ëˆŒëŸ¬ì„œ í™•ì¸í•˜ì„¸ìš” ğŸ ">
    <meta property="og:image" content="https://kangmin79.github.io/hwik-web/og-image.png?v=2">
    <meta property="og:image:width" content="800">
    <meta property="og:image:height" content="420">
    <meta property="og:url" content="https://kangmin79.github.io/hwik-web/property_view.html">

    <!-- ì¹´ì¹´ì˜¤í†¡ íŠ¹í™” -->
    <meta name="kakao:title" content="ë§¤ë¬¼ ì •ë³´ - íœ™">
    <meta name="kakao:description" content="ì¤‘ê°œì‚¬ê°€ ì§ì ‘ ë³´ë‚´ëŠ” ë§¤ë¬¼ ì¹´ë“œì˜ˆìš” ğŸ ">
    <meta name="description" content="ì¤‘ê°œì‚¬ê°€ ì§ì ‘ ë³´ë‚´ëŠ” ë§¤ë¬¼ ì¹´ë“œì˜ˆìš”. ëˆŒëŸ¬ì„œ í™•ì¸í•˜ì„¸ìš” ğŸ ">

    <!-- Supabase SDK -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <!-- ì¹´ì¹´ì˜¤ SDK -->
    <script src="https://t1.kakaocdn.net/kakao_js_sdk/2.7.2/kakao.min.js"
            integrity="sha384-TiCUE00h649CAMonG018J2ujOgDKW/kVWlChEuu4jK2vxfAAD0eZxzCKakxg55G4"
            crossorigin="anonymous"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        

        /* ========== ì¤‘ê°œì‚¬ ì½”ë©˜íŠ¸ ========== */
        .agent-comment-box {
            margin: 16px 0;
            padding: 14px 16px;
            background: rgba(250, 204, 21, 0.07);
            border-left: 3px solid #facc15;
            border-radius: 0 12px 12px 0;
        }

        .agent-comment-who {
            font-size: 11px;
            font-weight: 600;
            color: #facc15;
            margin-bottom: 6px;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .agent-comment-text {
            font-size: 14px;
            color: #e2e8f0;
            line-height: 1.7;
            white-space: pre-wrap;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Noto Sans KR', sans-serif;
            background: #0a0a12;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        /* í—¤ë” */
        .page-header {
            padding: 16px 20px;
            text-align: center;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        
        .logo {
            font-size: 24px;
            font-weight: 900;
            color: #facc15;
            text-decoration: none;
        }
        
        /* ë©”ì¸ ì»¨í…ì¸  */
        .main {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 24px 20px;
        }
        
        /* ì¹´ë“œ ì»¨í…Œì´ë„ˆ */
        .card-container {
            width: 100%;
            max-width: 340px;
            margin-bottom: 24px;
            touch-action: none;
        }
        
        /* ========== v3 ì¹´ë“œ ìŠ¤íƒ€ì¼ ========== */
        .card {
            width: 100%;
            border-radius: 16px;
            overflow: hidden;
            user-select: none;
            transition: transform 0.3s ease, opacity 0.3s ease;
            cursor: grab;
        }
        
        .card.dragging {
            transition: none;
            cursor: grabbing;
        }
        
        .swipe-indicator {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 60px;
            opacity: 0;
            transition: opacity 0.2s;
            pointer-events: none;
            z-index: 100;
            color: #fff;
            text-shadow: 0 0 20px rgba(255,255,255,0.5);
        }
        
        .swipe-indicator.show {
            opacity: 0.9;
        }
        
        /* ========== ì‚¬ì§„ ê°¤ëŸ¬ë¦¬ ========== */
        .card-photo-area {
            width: 100%; height: 180px; position: relative; overflow: hidden;
            cursor: pointer; background: #111;
        }
        .card-photo-area img {
            width: 100%; height: 100%; object-fit: cover;
        }
        .card-photo-count {
            position: absolute; bottom: 8px; right: 8px;
            background: rgba(0,0,0,0.6); color: #fff; font-size: 11px;
            padding: 3px 8px; border-radius: 10px;
        }
        
        /* í’€ìŠ¤í¬ë¦° ê°¤ëŸ¬ë¦¬ */
        .gallery-overlay {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.95); z-index: 9999;
            flex-direction: column; align-items: center; justify-content: center;
        }
        .gallery-overlay.show { display: flex; }
        .gallery-close {
            position: absolute; top: 16px; right: 16px; width: 36px; height: 36px;
            background: rgba(255,255,255,0.15); border: none; color: #fff;
            font-size: 20px; border-radius: 50%; cursor: pointer; z-index: 10;
        }
        .gallery-counter {
            position: absolute; top: 20px; left: 50%; transform: translateX(-50%);
            color: #fff; font-size: 14px; z-index: 10;
        }
        .gallery-img-wrap {
            width: 100%; height: 100%; display: flex; align-items: center; justify-content: center;
            touch-action: none; cursor: grab;
        }
        .gallery-img-wrap img {
            max-width: 95%; max-height: 80vh; object-fit: contain;
            transition: transform 0.3s ease, opacity 0.3s ease;
        }
        .gallery-img-wrap img.dragging { transition: none; cursor: grabbing; }

        /* ========== íƒ€ì… A: ë¯¸ë‹ˆë©€ ë‹¤í¬ ========== */
        .card-a { background: #1a1a2e; }
        .card-a .card-header { padding: 12px 16px; display: flex; justify-content: space-between; align-items: center; }
        .card-a .badge { padding: 5px 12px; border-radius: 16px; font-size: 12px; font-weight: 700; }
        .card-a .area-badge { color: #888; font-size: 11px; }
        .card-a .body { padding: 16px; }
        .card-a .complex-name { font-size: 18px; font-weight: 700; color: #fff; margin-bottom: 3px; }
        .card-a .location { font-size: 12px; color: #666; margin-bottom: 14px; }
        .card-a .price { font-size: 26px; font-weight: 800; margin-bottom: 14px; }
        .card-a .info-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-bottom: 14px; }
        .card-a .info-grid.single { grid-template-columns: 1fr; }
        .card-a .info-item { background: rgba(255,255,255,0.05); padding: 8px; border-radius: 6px; }
        .card-a .info-label { font-size: 9px; color: #666; margin-bottom: 2px; }
        .card-a .info-value { font-size: 13px; color: #fff; font-weight: 600; }
        .card-a .features { display: flex; flex-wrap: wrap; gap: 5px; margin-bottom: 14px; }
        .card-a .feature-tag { padding: 4px 8px; border-radius: 10px; font-size: 10px; }
        .card-a .agent { background: rgba(255,255,255,0.03); padding: 12px; border-radius: 8px; display: flex; justify-content: space-between; align-items: center; }
        .card-a .agent-name { font-size: 13px; color: #fff; font-weight: 600; }
        .card-a .agent-phone { font-size: 12px; }

        /* A ìƒ‰ìƒ */
        .card-a.mint { border: 2px solid rgba(78,205,196,0.3); }
        .card-a.mint .card-header { background: rgba(78,205,196,0.15); }
        .card-a.mint .badge { background: #4ecdc4; color: #1a1a2e; }
        .card-a.mint .price { color: #4ecdc4; }
        .card-a.mint .feature-tag { background: rgba(78,205,196,0.1); color: #4ecdc4; }
        .card-a.mint .agent-phone { color: #4ecdc4; }

        .card-a.purple { border: 2px solid rgba(167,139,250,0.3); }
        .card-a.purple .card-header { background: rgba(167,139,250,0.15); }
        .card-a.purple .badge { background: #a78bfa; color: #1a1a2e; }
        .card-a.purple .price { color: #a78bfa; }
        .card-a.purple .feature-tag { background: rgba(167,139,250,0.1); color: #a78bfa; }
        .card-a.purple .agent-phone { color: #a78bfa; }

        .card-a.blue { border: 2px solid rgba(96,165,250,0.3); }
        .card-a.blue .card-header { background: rgba(96,165,250,0.15); }
        .card-a.blue .badge { background: #60a5fa; color: #1a1a2e; }
        .card-a.blue .price { color: #60a5fa; }
        .card-a.blue .feature-tag { background: rgba(96,165,250,0.1); color: #60a5fa; }
        .card-a.blue .agent-phone { color: #60a5fa; }

        .card-a.orange { border: 2px solid rgba(251,146,60,0.3); }
        .card-a.orange .card-header { background: rgba(251,146,60,0.15); }
        .card-a.orange .badge { background: #fb923c; color: #1a1a2e; }
        .card-a.orange .price { color: #fb923c; }
        .card-a.orange .feature-tag { background: rgba(251,146,60,0.1); color: #fb923c; }
        .card-a.orange .agent-phone { color: #fb923c; }

        .card-a.pink { border: 2px solid rgba(244,114,182,0.3); }
        .card-a.pink .card-header { background: rgba(244,114,182,0.15); }
        .card-a.pink .badge { background: #f472b6; color: #1a1a2e; }
        .card-a.pink .price { color: #f472b6; }
        .card-a.pink .feature-tag { background: rgba(244,114,182,0.1); color: #f472b6; }
        .card-a.pink .agent-phone { color: #f472b6; }

        .card-a.gold { border: 2px solid rgba(251,191,36,0.3); }
        .card-a.gold .card-header { background: rgba(251,191,36,0.15); }
        .card-a.gold .badge { background: #fbbf24; color: #1a1a2e; }
        .card-a.gold .price { color: #fbbf24; }
        .card-a.gold .feature-tag { background: rgba(251,191,36,0.1); color: #fbbf24; }
        .card-a.gold .agent-phone { color: #fbbf24; }






        /* ========== íƒ€ì… F: ë„¤ì˜¨ í…Œë‘ë¦¬ ========== */
        .card-f { background: #0a0a12; border-radius: 20px; padding: 18px; }
        .card-f .card-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 14px; }
        .card-f .badge { padding: 5px 12px; border-radius: 14px; font-size: 11px; font-weight: 700; }
        .card-f .area-badge { font-size: 11px; }
        .card-f .complex-name { font-size: 18px; font-weight: 700; color: #fff; margin-bottom: 3px; }
        .card-f .location { font-size: 11px; color: #666; margin-bottom: 14px; }
        .card-f .price { font-size: 28px; font-weight: 800; margin-bottom: 14px; }
        .card-f .info-row { display: flex; gap: 12px; margin-bottom: 14px; }
        .card-f .info-row.single { justify-content: center; }
        .card-f .info-row.single .info-item { flex: 0 0 auto; min-width: 120px; }
        .card-f .info-item { flex: 1; border: 1px solid rgba(255,255,255,0.1); padding: 10px; border-radius: 8px; text-align: center; }
        .card-f .info-value { font-size: 14px; color: #fff; font-weight: 600; }
        .card-f .info-label { font-size: 9px; color: #666; margin-top: 2px; }
        .card-f .agent { border-top: 1px solid rgba(255,255,255,0.1); padding-top: 14px; display: flex; justify-content: space-between; align-items: center; }
        .card-f .agent-name { font-size: 13px; color: #888; }
        .card-f .agent-phone { font-size: 13px; font-weight: 600; }

        .card-f.mint { border: 3px solid #4ecdc4; box-shadow: 0 0 20px rgba(78,205,196,0.3); }
        .card-f.mint .badge { background: #4ecdc4; color: #0a0a12; }
        .card-f.mint .area-badge, .card-f.mint .price, .card-f.mint .agent-phone { color: #4ecdc4; }
        .card-f.purple { border: 3px solid #a78bfa; box-shadow: 0 0 20px rgba(167,139,250,0.3); }
        .card-f.purple .badge { background: #a78bfa; color: #0a0a12; }
        .card-f.purple .area-badge, .card-f.purple .price, .card-f.purple .agent-phone { color: #a78bfa; }
        .card-f.blue { border: 3px solid #60a5fa; box-shadow: 0 0 20px rgba(96,165,250,0.3); }
        .card-f.blue .badge { background: #60a5fa; color: #0a0a12; }
        .card-f.blue .area-badge, .card-f.blue .price, .card-f.blue .agent-phone { color: #60a5fa; }
        .card-f.orange { border: 3px solid #fb923c; box-shadow: 0 0 20px rgba(251,146,60,0.3); }
        .card-f.orange .badge { background: #fb923c; color: #0a0a12; }
        .card-f.orange .area-badge, .card-f.orange .price, .card-f.orange .agent-phone { color: #fb923c; }
        .card-f.pink { border: 3px solid #f472b6; box-shadow: 0 0 20px rgba(244,114,182,0.3); }
        .card-f.pink .badge { background: #f472b6; color: #0a0a12; }
        .card-f.pink .area-badge, .card-f.pink .price, .card-f.pink .agent-phone { color: #f472b6; }
        .card-f.gold { border: 3px solid #fbbf24; box-shadow: 0 0 20px rgba(251,191,36,0.3); }
        .card-f.gold .badge { background: #fbbf24; color: #0a0a12; }
        .card-f.gold .area-badge, .card-f.gold .price, .card-f.gold .agent-phone { color: #fbbf24; }

        /* ========== íƒ€ì… J: í…Œì´ë¸”í˜• ========== */
        .card-j { background: #1a1a2e; }
        .card-j .card-header { padding: 14px 16px; display: flex; justify-content: space-between; align-items: center; }
        .card-j .badge { padding: 5px 12px; border-radius: 14px; font-size: 11px; font-weight: 700; }
        .card-j .price { font-size: 22px; font-weight: 800; }
        .card-j .body { padding: 0 16px 16px; }
        .card-j .complex-name { font-size: 16px; font-weight: 700; color: #fff; margin-bottom: 2px; }
        .card-j .location { font-size: 11px; color: #666; margin-bottom: 12px; }
        .card-j table { width: 100%; border-collapse: collapse; margin-bottom: 12px; }
        .card-j td { padding: 8px 0; font-size: 12px; border-bottom: 1px solid rgba(255,255,255,0.05); }
        .card-j td:first-child { color: #666; width: 70px; }
        .card-j td:last-child { color: #fff; font-weight: 500; }
        .card-j .agent { padding-top: 12px; border-top: 1px solid rgba(255,255,255,0.1); display: flex; justify-content: space-between; font-size: 12px; }
        .card-j .agent-name { color: #888; }
        .card-j .agent-phone { font-weight: 600; }

        .card-j.mint { border-top: 3px solid #4ecdc4; }
        .card-j.mint .card-header { background: rgba(78,205,196,0.1); }
        .card-j.mint .badge { background: #4ecdc4; color: #1a1a2e; }
        .card-j.mint .price, .card-j.mint .agent-phone { color: #4ecdc4; }
        .card-j.purple { border-top: 3px solid #a78bfa; }
        .card-j.purple .card-header { background: rgba(167,139,250,0.1); }
        .card-j.purple .badge { background: #a78bfa; color: #1a1a2e; }
        .card-j.purple .price, .card-j.purple .agent-phone { color: #a78bfa; }
        .card-j.blue { border-top: 3px solid #60a5fa; }
        .card-j.blue .card-header { background: rgba(96,165,250,0.1); }
        .card-j.blue .badge { background: #60a5fa; color: #1a1a2e; }
        .card-j.blue .price, .card-j.blue .agent-phone { color: #60a5fa; }
        .card-j.orange { border-top: 3px solid #fb923c; }
        .card-j.orange .card-header { background: rgba(251,146,60,0.1); }
        .card-j.orange .badge { background: #fb923c; color: #1a1a2e; }
        .card-j.orange .price, .card-j.orange .agent-phone { color: #fb923c; }
        .card-j.pink { border-top: 3px solid #f472b6; }
        .card-j.pink .card-header { background: rgba(244,114,182,0.1); }
        .card-j.pink .badge { background: #f472b6; color: #1a1a2e; }
        .card-j.pink .price, .card-j.pink .agent-phone { color: #f472b6; }
        .card-j.gold { border-top: 3px solid #fbbf24; }
        .card-j.gold .card-header { background: rgba(251,191,36,0.1); }
        .card-j.gold .badge { background: #fbbf24; color: #1a1a2e; }
        .card-j.gold .price, .card-j.gold .agent-phone { color: #fbbf24; }

        /* ì•¡ì…˜ ë²„íŠ¼ */
        .actions {
            width: 100%;
            max-width: 340px;
            display: flex;
            flex-direction: row;
            align-items: center;
            gap: 10px;
            margin-top: 4px;
        }
        
        .action-btn-call {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 13px 16px;
            border-radius: 12px;
            font-size: 15px;
            font-weight: 700;
            text-decoration: none;
            background: #4ecdc4;
            color: #0a0a12;
            transition: all 0.2s;
            border: none;
            cursor: pointer;
        }
        .action-btn-call:hover {
            background: #3dbdb5;
            transform: translateY(-1px);
        }

        .action-btn-sms {
            flex: 0 0 auto;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 46px;
            height: 46px;
            border-radius: 12px;
            font-size: 20px;
            text-decoration: none;
            background: rgba(255,255,255,0.07);
            border: 1px solid rgba(255,255,255,0.12);
            color: #fff;
            transition: all 0.2s;
            cursor: pointer;
        }
        .action-btn-sms:hover {
            background: rgba(255,255,255,0.12);
            transform: translateY(-1px);
        }
        
        .action-btn-kakao {
            flex: 0 0 auto;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 46px;
            height: 46px;
            border-radius: 12px;
            background: #FEE500;
            border: none;
            cursor: pointer;
            transition: all 0.2s;
        }
        .action-btn-kakao:hover {
            background: #f0d800;
            transform: translateY(-1px);
        }
        .action-btn-kakao img {
            width: 26px;
            height: 26px;
        }

        /* í‘¸í„° */
        .footer {
            padding: 20px;
            text-align: center;
            color: #666;
            font-size: 12px;
        }
        
        .footer a {
            color: #facc15;
            text-decoration: none;
        }
    </style>
</head>
<body>
    <!-- í—¤ë” -->
    <header class="page-header">
        <a href="#" class="logo">íœ™</a>
    </header>
    
    <!-- ë©”ì¸ -->
    <main class="main">
        <!-- ì¹´ë“œ ì»¨í…Œì´ë„ˆ -->
        <div class="swipe-indicator" id="swipeIndicator">íœ™!</div>
        
        <!-- í’€ìŠ¤í¬ë¦° ê°¤ëŸ¬ë¦¬ -->
        <div class="gallery-overlay" id="galleryOverlay">
            <button class="gallery-close" onclick="closeGallery()">Ã—</button>
            <div class="gallery-counter" id="galleryCounter">1 / 3</div>
            <div class="gallery-img-wrap" id="galleryImgWrap">
                <img id="galleryImg" src="">
            </div>
        </div>
        
        <div class="card-container" id="cardContainer">
            <!-- ì¹´ë“œê°€ ì—¬ê¸°ì— ë Œë”ë§ë¨ -->
        </div>
        
        <!-- ì•¡ì…˜ ë²„íŠ¼ -->
        <div class="actions">
            <a href="tel:010-1234-5678" class="action-btn-call" id="callBtn">
                ğŸ“ ì „í™”í•˜ê¸°
            </a>
            <a href="sms:010-1234-5678" class="action-btn-sms" id="smsBtn" title="ë¬¸ìí•˜ê¸°">
                ğŸ’¬
            </a>
            <button onclick="shareToKakao()" class="action-btn-kakao" id="kakaoBtn" title="ì¹´ì¹´ì˜¤í†¡ ê³µìœ ">
                <img src="https://developers.kakao.com/assets/img/about/logos/kakaolink/kakaolink_btn_medium.png">
            </button>
        </div>
    </main>
    
    <!-- í‘¸í„° -->
    <footer class="footer">
        <a href="https://kangmin79.github.io/hwik-web/" style="display: inline-flex; align-items: center; gap: 6px; color: #facc15; text-decoration: none; font-size: 13px;">
            <span style="font-weight: 700;">íœ™</span>ìœ¼ë¡œ ë§Œë“  ë§¤ë¬¼ì¹´ë“œ Â· ë‚˜ë„ ì¨ë³´ê¸° â†’
        </a>
    </footer>
    
    <script>
        // Supabase ì´ˆê¸°í™”
        const SUPABASE_URL = 'https://jqaxejgzkchxbfzgzyzi.supabase.co';
        const SUPABASE_KEY = 'sb_publishable_A6eDGlqSejIZDsi1O6XrLg_fOK6yOBN';
        const supabaseClient = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
        
        // ì—¬ëŸ¬ ì¹´ë“œ ìƒíƒœ
        let allCardsData = [];
        let currentIndex = 0;
        
        // ìŠ¤ì™€ì´í”„ ìƒíƒœ
        let isDragging = false;
        let startX = 0;
        let currentX = 0;
        let cardElement = null;
        
        // ë¡œë”© ìƒíƒœ í‘œì‹œ
        function showLoading() {
            document.getElementById('cardContainer').innerHTML = `
                <div style="text-align: center; padding: 40px; color: #888;">
                    <div style="font-size: 24px; margin-bottom: 10px;">â³</div>
                    <div>ë§¤ë¬¼ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
                </div>
            `;
        }
        
        // ì—ëŸ¬ í‘œì‹œ
        function showError(message, emoji = 'âŒ') {
            document.getElementById('cardContainer').innerHTML = `
                <div style="text-align: center; padding: 40px; color: #888;">
                    <div style="font-size: 40px; margin-bottom: 16px;">${emoji}</div>
                    <div style="font-size: 15px; line-height: 1.6;">${message}</div>
                </div>
            `;
            const actionsEl = document.querySelector('.actions');
            if (actionsEl) actionsEl.style.display = 'none';
        }
        
        // 7ì¼ ë§Œë£Œ ì²´í¬
        function isExpired(createdAt) {
            if (!createdAt) return false;
            const created = new Date(createdAt);
            const now = new Date();
            const diffDays = (now - created) / (1000 * 60 * 60 * 24);
            return diffDays > 7;
        }
        
        // ì¹´ë“œ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
        async function loadCard(cardId) {
            showLoading();
            
            try {
                const { data, error } = await supabaseClient
                    .from('cards')
                    .select('*')
                    .eq('id', cardId)
                    .single();
                
                if (error) throw error;
                if (!data) { showError('ë§¤ë¬¼ ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.'); return; }
                if (isExpired(data.created_at)) { showError('ì´ ë§í¬ëŠ” ë§Œë£Œë˜ì—ˆìŠµë‹ˆë‹¤.<br><br>ê³µì¸ì¤‘ê°œì‚¬ì—ê²Œ ìƒˆ ë§í¬ë¥¼ ìš”ì²­í•´ ì£¼ì„¸ìš”.', 'â°'); return; }
                
                supabaseClient.from('cards').update({ view_count: (data.view_count || 0) + 1 }).eq('id', cardId);
                allCardsData = [data];
                currentIndex = 0;
                renderCard(data);
                
            } catch (error) {
                console.error('ì¹´ë“œ ë¡œë”© ì˜¤ë¥˜:', error);
                showError('ë§¤ë¬¼ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
            }
        }
        
        // OG íƒœê·¸ ë™ì  ì—…ë°ì´íŠ¸
        function updateOGTags(data) {
            const p = data.property || {};
            const agent = data.agent || {};
            const name = p.complex || p.location || 'ë§¤ë¬¼';
            const type = p.type || '';
            const price = p.price || '';
            const area = p.area ? ` Â· ${p.area}` : '';
            const agentName = agent.business_name || agent.name || 'ì¤‘ê°œì‚¬';

            const title = `${type} ${price} Â· ${name}${area}`;
            const desc = `${agentName}ì´ ë³´ë‚´ëŠ” ë§¤ë¬¼ì´ì—ìš”. ì§€ê¸ˆ í™•ì¸í•´ë³´ì„¸ìš” ğŸ `;

            document.title = title;
            setMeta('og:title', title);
            setMeta('og:description', desc);
            setMeta('description', desc);
            setMeta('og:url', window.location.href);
        }

        function updateOGTagsMulti(cards) {
            if (!cards.length) return;
            const agent = cards[0].agent || {};
            const agentName = agent.business_name || agent.name || 'ì¤‘ê°œì‚¬';
            const count = cards.length;
            const first = cards[0].property || {};
            const firstName = first.complex || first.location || 'ë§¤ë¬¼';

            const title = `${agentName}ì˜ ë§¤ë¬¼ ${count}ê°œ Â· ${firstName} ì™¸`;
            const desc = `${count}ê°œ ë§¤ë¬¼ì„ ë¬¶ì–´ì„œ ë³´ë‚´ë“œë ¤ìš”. ëˆŒëŸ¬ì„œ í™•ì¸í•˜ì„¸ìš” ğŸ `;

            document.title = title;
            setMeta('og:title', title);
            setMeta('og:description', desc);
            setMeta('description', desc);
            setMeta('og:url', window.location.href);
        }

        function setMeta(name, content) {
            const isProp = name.startsWith('og:') || name.startsWith('kakao:');
            const attr = isProp ? 'property' : 'name';
            let el = document.querySelector(`meta[${attr}="${name}"]`);
            if (!el) {
                el = document.createElement('meta');
                el.setAttribute(attr, name);
                document.head.appendChild(el);
            }
            el.setAttribute('content', content);
        }

        // ì¹´ë“œ ë Œë”ë§
        function renderCard(data) {
            const container = document.getElementById('cardContainer');
            const { style: rawStyle, color, property, agent } = data;
            const style = (rawStyle === 'd' || rawStyle === 'e') ? 'a' : (rawStyle || 'a'); // ì‚­ì œëœ ìŠ¤íƒ€ì¼ ëŒ€ì²´
            const p = property;
            
            const type = p.type || 'ì „ì„¸';
            const price = p.price || '-';
            const name = p.complex || p.location || '-';
            const location = p.complex ? (p.location || '') : '';
            const area = p.area || '';
            const floor = p.floor || '';
            const room = p.room || '';
            const features = p.features || [];
            const agentName = agent?.name || 'ë¶€ë™ì‚°';
            const agentPhone = agent?.phone || '';
            const agentPhoto = agent?.profile_photo || null;
            const photos = data.photos || [];

            updateOGTags(data);
            
            // í”„ë¡œí•„ ì‚¬ì§„ HTML
            const agentPhotoHtml = agentPhoto 
                ? `<img src="${agentPhoto}" style="width:32px;height:32px;border-radius:50%;object-fit:cover;border:1.5px solid #facc15;">`
                : '';
            
            // ì‚¬ì§„ ì˜ì—­ HTML
            const photoHtml = photos.length > 0 ? `
                <div class="card-photo-area" onclick="openGallery()">
                    <img src="${photos[0]}">
                    ${photos.length > 1 ? `<div class="card-photo-count">ğŸ“· ${photos.length}</div>` : ''}
                </div>
            ` : '';
            
            let html = '';
            
            if (style === 'a') {
                const infoItems = [];
                if (floor) infoItems.push(`<div class="info-item"><div class="info-label">ì¸µìˆ˜</div><div class="info-value">${floor}</div></div>`);
                if (room) infoItems.push(`<div class="info-item"><div class="info-label">êµ¬ì¡°</div><div class="info-value">${room}</div></div>`);
                const gridClass = infoItems.length === 1 ? 'info-grid single' : 'info-grid';
                
                html = `
                    <div class="card card-a ${color}">
                        ${photoHtml}
                        <div class="card-header">
                            <span class="badge">${type}</span>
                            <span class="area-badge">${area}</span>
                        </div>
                        <div class="body">
                            <div class="complex-name">${name}</div>
                            ${location ? `<div class="location">${location}</div>` : ''}
                            <div class="price">${price}</div>
                            ${infoItems.length ? `<div class="${gridClass}">${infoItems.join('')}</div>` : ''}
                            ${features.length ? `<div class="features">${features.map(f => `<span class="feature-tag">${f}</span>`).join('')}</div>` : ''}
                            <div class="agent">
                                ${agentPhotoHtml ? `<span style="margin-right:6px;">${agentPhotoHtml}</span>` : ''}
                                <span class="agent-name">${agentName}</span>
                                <span class="agent-phone">${agentPhone}</span>
                            </div>
                        </div>
                    </div>
                `;
            } else if (style === 'f') {
                const infoItemsF = [];
                if (floor) infoItemsF.push(`<div class="info-item"><div class="info-value">${floor}</div><div class="info-label">ì¸µìˆ˜</div></div>`);
                if (room) infoItemsF.push(`<div class="info-item"><div class="info-value">${room}</div><div class="info-label">êµ¬ì¡°</div></div>`);
                const rowClassF = infoItemsF.length === 1 ? 'info-row single' : 'info-row';
                
                html = `
                    <div class="card card-f ${color}">
                        ${photoHtml}
                        <div class="card-header">
                            <span class="badge">${type}</span>
                            <span class="area-badge">${area}</span>
                        </div>
                        <div class="complex-name">${name}</div>
                        ${location ? `<div class="location">${location}</div>` : ''}
                        <div class="price">${price}</div>
                        ${infoItemsF.length ? `<div class="${rowClassF}">${infoItemsF.join('')}</div>` : ''}
                        <div class="agent">
                            ${agentPhotoHtml ? `<span style="margin-right:6px;">${agentPhotoHtml}</span>` : ''}
                            <span class="agent-name">${agentName}</span>
                            <span class="agent-phone">${agentPhone}</span>
                        </div>
                    </div>
                `;
            } else if (style === 'j') {
                html = `
                    <div class="card card-j ${color}">
                        ${photoHtml}
                        <div class="card-header">
                            <span class="badge">${type}</span>
                            <span class="price">${price}</span>
                        </div>
                        <div class="body">
                            <div class="complex-name">${name}</div>
                            ${location ? `<div class="location">${location}</div>` : ''}
                            <table>
                                ${area ? `<tr><td>ë©´ì </td><td>${area}</td></tr>` : ''}
                                ${floor ? `<tr><td>ì¸µìˆ˜</td><td>${floor}</td></tr>` : ''}
                                ${room ? `<tr><td>êµ¬ì¡°</td><td>${room}</td></tr>` : ''}
                                ${features.length ? `<tr><td>íŠ¹ì§•</td><td>${features.join(', ')}</td></tr>` : ''}
                            </table>
                            <div class="agent">
                                ${agentPhotoHtml ? `<span style="margin-right:6px;">${agentPhotoHtml}</span>` : ''}
                                <span class="agent-name">${agentName}</span>
                                <span class="agent-phone">${agentPhone}</span>
                            </div>
                        </div>
                    </div>
                `;
            }
            
            // ì¤‘ê°œì‚¬ ì½”ë©˜íŠ¸ ì¶”ê°€
            const agentComment = data.agent_comment;
            if (agentComment) {
                const commentAgentName = agent?.name || 'ì¤‘ê°œì‚¬';
                html += `
                    <div class="agent-comment-box">
                        <div class="agent-comment-who">ğŸ’¬ ${commentAgentName}ì˜ í•œë§ˆë””</div>
                        <div class="agent-comment-text">${agentComment.replace(/</g,'&lt;').replace(/>/g,'&gt;')}</div>
                    </div>
                `;
            }

            container.innerHTML = html;
            
            if (agentPhone) {
                document.getElementById('callBtn').href = `tel:${agentPhone.replace(/-/g, '')}`;
                document.getElementById('smsBtn').href = `sms:${agentPhone.replace(/-/g, '')}`;
            }
            
            updateNavigation();
            setupSwipe();
        }
        
        // ì—¬ëŸ¬ ì¹´ë“œ ë¡œë“œ
        async function loadMultipleCards(cardIds) {
            showLoading();
            
            try {
                const { data, error } = await supabaseClient
                    .from('cards')
                    .select('*')
                    .in('id', cardIds);
                
                if (error) throw error;
                if (!data || data.length === 0) { showError('ë§¤ë¬¼ ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.'); return; }
                
                allCardsData = cardIds.map(id => data.find(d => d.id === id)).filter(Boolean);
                const validCards = allCardsData.filter(d => !isExpired(d.created_at));
                allCardsData = validCards;
                
                if (allCardsData.length === 0) { showError('ì´ ë§í¬ëŠ” ë§Œë£Œë˜ì—ˆìŠµë‹ˆë‹¤.<br><br>ê³µì¸ì¤‘ê°œì‚¬ì—ê²Œ ìƒˆ ë§í¬ë¥¼ ìš”ì²­í•´ ì£¼ì„¸ìš”.', 'â°'); return; }
                currentIndex = 0;
                
                if (allCardsData.length > 0) {
                    renderCard(allCardsData[0]);
                    if (allCardsData.length > 1) updateOGTagsMulti(allCardsData);
                }
                
            } catch (error) {
                console.error('ì¹´ë“œ ë¡œë”© ì˜¤ë¥˜:', error);
                showError('ë§¤ë¬¼ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
            }
        }
        
        // ë„¤ë¹„ê²Œì´ì…˜ ì—…ë°ì´íŠ¸
        function updateNavigation() {
            const existingNav = document.getElementById('cardNav');
            if (existingNav) existingNav.remove();
            if (allCardsData.length <= 1) return;
            
            const nav = document.createElement('div');
            nav.id = 'cardNav';
            nav.style.cssText = 'display: flex; align-items: center; justify-content: center; gap: 12px; margin-bottom: 16px;';
            
            const indicator = document.createElement('div');
            indicator.id = 'cardIndicator';
            indicator.style.cssText = 'font-size: 14px; color: #888;';
            indicator.innerHTML = `<span style="color: #fff; font-weight: 600;">${currentIndex + 1}</span> / ${allCardsData.length}`;
            nav.appendChild(indicator);
            
            const dots = document.createElement('div');
            dots.id = 'cardDots';
            dots.style.cssText = 'display: flex; gap: 6px; margin-left: 12px;';
            
            for (let i = 0; i < allCardsData.length; i++) {
                const dot = document.createElement('div');
                dot.style.cssText = `width: 8px; height: 8px; border-radius: 50%; background: ${i === currentIndex ? '#facc15' : 'rgba(255,255,255,0.2)'}; transition: background 0.2s;`;
                dot.dataset.index = i;
                dot.onclick = () => goToCard(i);
                dots.appendChild(dot);
            }
            nav.appendChild(dots);
            
            const container = document.getElementById('cardContainer');
            container.parentNode.insertBefore(nav, container);
        }
        
        function updateIndicator() {
            const indicator = document.getElementById('cardIndicator');
            if (indicator) indicator.innerHTML = `<span style="color: #fff; font-weight: 600;">${currentIndex + 1}</span> / ${allCardsData.length}`;
            const dots = document.querySelectorAll('#cardDots div');
            dots.forEach((dot, i) => { dot.style.background = i === currentIndex ? '#facc15' : 'rgba(255,255,255,0.2)'; });
        }
        
        function goToCard(index) {
            if (index < 0 || index >= allCardsData.length) return;
            currentIndex = index;
            renderCard(allCardsData[currentIndex]);
        }
        
        // ìŠ¤ì™€ì´í”„ ì„¤ì • (í‹´ë” ìŠ¤íƒ€ì¼: íšŒì „ + ë‚ ì•„ê° + ìƒˆ ì¹´ë“œ ë“±ì¥)
        function setupSwipe() {
            if (allCardsData.length <= 1) return;
            const container = document.getElementById('cardContainer');
            cardElement = container.querySelector('.card');
            if (!cardElement) return;
            
            let _startX, _startY, _currentX, _currentY;
            const threshold = 60;
            
            const onStart = (e) => {
                if (e.target.closest('a')) return;
                isDragging = true;
                cardElement.classList.add('dragging');
                const touch = e.touches ? e.touches[0] : e;
                _startX = touch.clientX;
                _startY = touch.clientY;
                _currentX = 0;
                _currentY = 0;
            };
            
            const onMove = (e) => {
                if (!isDragging) return;
                e.preventDefault();
                const touch = e.touches ? e.touches[0] : e;
                _currentX = touch.clientX - _startX;
                _currentY = touch.clientY - _startY;
                const rotate = _currentX * 0.05;
                cardElement.style.transform = `translate(${_currentX}px, ${_currentY}px) rotate(${rotate}deg)`;
                cardElement.style.opacity = 1 - Math.abs(_currentX) / 400;
            };
            
            const onEnd = () => {
                if (!isDragging) return;
                isDragging = false;
                cardElement.classList.remove('dragging');
                
                const absX = Math.abs(_currentX);
                
                if (absX > threshold) {
                    // ìŠ¤ì™€ì´í”„ â†’ ì¹´ë“œ ë‚ ë ¤ë³´ë‚´ê¸°
                    const direction = _currentX > 0 ? 'right' : 'left';
                    const exitX = direction === 'left' ? -500 : 500;
                    
                    showSwipeIndicator();
                    
                    cardElement.style.transition = 'transform 0.3s ease, opacity 0.3s ease';
                    cardElement.style.transform = `translate(${exitX}px, 0) rotate(${exitX * 0.1}deg)`;
                    cardElement.style.opacity = '0';
                    
                    setTimeout(() => {
                        // ì™¼ìª½=ë‹¤ìŒ, ì˜¤ë¥¸ìª½=ì´ì „
                        let nextIndex = currentIndex;
                        if (direction === 'left' && currentIndex < allCardsData.length - 1) {
                            nextIndex = currentIndex + 1;
                        } else if (direction === 'right' && currentIndex > 0) {
                            nextIndex = currentIndex - 1;
                        } else {
                            // ëì´ë©´ ì›ë˜ ìë¦¬ë¡œ
                            cardElement.style.transform = '';
                            cardElement.style.opacity = '';
                            return;
                        }
                        
                        currentIndex = nextIndex;
                        renderCard(allCardsData[currentIndex]);
                        
                        // ìƒˆ ì¹´ë“œ ë“±ì¥ ì• ë‹ˆë©”ì´ì…˜
                        const newCard = container.querySelector('.card');
                        if (newCard) {
                            newCard.style.opacity = '0';
                            newCard.style.transform = 'scale(0.9)';
                            requestAnimationFrame(() => {
                                newCard.style.transition = 'transform 0.2s ease, opacity 0.2s ease';
                                newCard.style.transform = '';
                                newCard.style.opacity = '';
                            });
                        }
                    }, 250);
                } else {
                    // ë³µê·€
                    cardElement.style.transform = '';
                    cardElement.style.opacity = '';
                }
            };
            
            cardElement.addEventListener('touchstart', onStart, { passive: true });
            cardElement.addEventListener('touchmove', onMove, { passive: false });
            cardElement.addEventListener('touchend', onEnd);
            cardElement.addEventListener('mousedown', onStart);
            cardElement.addEventListener('mousemove', onMove);
            cardElement.addEventListener('mouseup', onEnd);
            cardElement.addEventListener('mouseleave', onEnd);
        }
        
        function showSwipeIndicator() {
            const indicator = document.getElementById('swipeIndicator');
            if (!indicator) return;
            indicator.classList.add('show');
            setTimeout(() => indicator.classList.remove('show'), 300);
        }
        
        // =================== ì¹´ì¹´ì˜¤ ê³µìœ  ===================
        const KAKAO_JS_KEY = '124cd68b3419bde24e03efa4f1ca2830';

        function initKakao() {
            if (!window.Kakao) return;
            if (!Kakao.isInitialized()) Kakao.init(KAKAO_JS_KEY);
        }

        function shareToKakao() {
            initKakao();
            if (!window.Kakao || !Kakao.isInitialized()) {
                alert('ì¹´ì¹´ì˜¤ SDK ë¡œë”© ì¤‘ì…ë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
                return;
            }

            const card = allCardsData[currentIndex] || allCardsData[0];
            if (!card) return;

            const p = card.property || {};
            const agent = card.agent || {};

            const title = `${p.type || ''} ${p.price || ''} Â· ${p.complex || p.location || 'ë§¤ë¬¼'}`;
            const desc = `${agent.business_name || agent.name || 'ì¤‘ê°œì‚¬'}ì´ ë³´ë‚´ëŠ” ë§¤ë¬¼ì´ì—ìš” ğŸ `;
            const pageUrl = window.location.href;

            // â˜… OG ì´ë¯¸ì§€: ì¹´ë“œì— ì €ì¥ëœ ì´ë¯¸ì§€ â†’ ì¤‘ê°œì‚¬ Storage ì´ë¯¸ì§€ â†’ ê¸°ë³¸ ì´ë¯¸ì§€
            const agentId = card.agent_id || '';
            const imageUrl = card.og_image_url
                ? card.og_image_url
                : agentId
                    ? `https://api.hwik.kr/storage/v1/object/public/og-images/agents/${agentId}.png`
                    : 'https://kangmin79.github.io/hwik-web/og-image.png';

            Kakao.Share.sendDefault({
                objectType: 'feed',
                content: {
                    title: title,
                    description: desc,
                    imageUrl: imageUrl,
                    imageWidth: 800,
                    imageHeight: 420,
                    link: {
                        mobileWebUrl: pageUrl,
                        webUrl: pageUrl,
                    },
                },
                buttons: [
                    {
                        title: 'ë§¤ë¬¼ í™•ì¸í•˜ê¸°',
                        link: {
                            mobileWebUrl: pageUrl,
                            webUrl: pageUrl,
                        },
                    },
                ],
            });
        }
        // =================== ì¹´ì¹´ì˜¤ ê³µìœ  ë ===================

        // =================== ì‚¬ì§„ ê°¤ëŸ¬ë¦¬ ===================
        let galleryPhotos = [];
        let galleryIndex = 0;
        let galleryDragging = false;
        let galStartX = 0, galStartY = 0, galCurX = 0, galCurY = 0;
        
        function openGallery() {
            const card = allCardsData[currentIndex];
            if (!card || !card.photos || !card.photos.length) return;
            galleryPhotos = card.photos;
            galleryIndex = 0;
            showGalleryImage();
            document.getElementById('galleryOverlay').classList.add('show');
            setupGallerySwipe();
        }
        
        function closeGallery() {
            document.getElementById('galleryOverlay').classList.remove('show');
        }
        
        function showGalleryImage() {
            const img = document.getElementById('galleryImg');
            img.src = galleryPhotos[galleryIndex];
            img.style.transform = '';
            img.style.opacity = '';
            document.getElementById('galleryCounter').textContent = `${galleryIndex + 1} / ${galleryPhotos.length}`;
        }
        
        function setupGallerySwipe() {
            const wrap = document.getElementById('galleryImgWrap');
            const img = document.getElementById('galleryImg');
            
            // ê¸°ì¡´ ë¦¬ìŠ¤ë„ˆ ì œê±° í›„ ì¬ë“±ë¡
            const newWrap = wrap.cloneNode(true);
            wrap.parentNode.replaceChild(newWrap, wrap);
            const newImg = newWrap.querySelector('img');
            
            const onStart = (e) => {
                galleryDragging = true;
                newImg.classList.add('dragging');
                const t = e.touches ? e.touches[0] : e;
                galStartX = t.clientX; galStartY = t.clientY;
                galCurX = 0; galCurY = 0;
            };
            const onMove = (e) => {
                if (!galleryDragging) return;
                e.preventDefault();
                const t = e.touches ? e.touches[0] : e;
                galCurX = t.clientX - galStartX;
                galCurY = t.clientY - galStartY;
                newImg.style.transform = `translate(${galCurX}px, ${galCurY}px)`;
                newImg.style.opacity = 1 - Math.max(Math.abs(galCurX), Math.abs(galCurY)) / 400;
            };
            const onEnd = () => {
                if (!galleryDragging) return;
                galleryDragging = false;
                newImg.classList.remove('dragging');
                const absX = Math.abs(galCurX), absY = Math.abs(galCurY);
                
                if (absY > 80 && absY > absX) {
                    // ìœ„/ì•„ë˜ â†’ ê°¤ëŸ¬ë¦¬ ë‹«ê¸°
                    newImg.style.transform = `translateY(${galCurY > 0 ? 500 : -500}px)`;
                    newImg.style.opacity = '0';
                    setTimeout(() => closeGallery(), 200);
                } else if (absX > 60 && absX > absY) {
                    // ì¢Œ/ìš° â†’ ì‚¬ì§„ ë„˜ê¸°ê¸°
                    if (galCurX < 0 && galleryIndex < galleryPhotos.length - 1) {
                        galleryIndex++;
                    } else if (galCurX > 0 && galleryIndex > 0) {
                        galleryIndex--;
                    }
                    showGalleryImage();
                } else {
                    newImg.style.transform = '';
                    newImg.style.opacity = '';
                }
            };
            
            newWrap.addEventListener('touchstart', onStart, { passive: true });
            newWrap.addEventListener('touchmove', onMove, { passive: false });
            newWrap.addEventListener('touchend', onEnd);
            newWrap.addEventListener('mousedown', onStart);
            newWrap.addEventListener('mousemove', onMove);
            newWrap.addEventListener('mouseup', onEnd);
            newWrap.addEventListener('mouseleave', onEnd);
        }

        // URLì—ì„œ ì¹´ë“œ ID ê°€ì ¸ì˜¤ê¸°
        const urlParams = new URLSearchParams(window.location.search);
        const cardId = urlParams.get('id');
        const cardIds = urlParams.get('ids');
        
        if (cardIds) {
            const ids = cardIds.split(',').filter(id => id.trim());
            if (ids.length > 0) loadMultipleCards(ids);
            else showError('ì˜ëª»ëœ ë§í¬ì…ë‹ˆë‹¤.');
        } else if (cardId) {
            allCardsData = [];
            loadCard(cardId);
        } else {
            showError('ì˜ëª»ëœ ë§í¬ì…ë‹ˆë‹¤.');
        }
    </script>
</body>
</html>
